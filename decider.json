{
  "script": "; This file is auto-generated. Do not edit manually: changes may be erased.\n; Generated by Aqua compiler: https://github.com/fluencelabs/aqua/.\n; If you find any bugs, please write an issue on GitHub: https://github.com/fluencelabs/aqua/issues\n; Aqua version: 0.9.5\n\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id)\n(call %init_peer_id% (\"getDataSrv\" \"listener_id\") [] listener_id)\n)\n(call %init_peer_id% (\"getDataSrv\" \"info\") [] info)\n)\n(call %init_peer_id% (\"getDataSrv\" \"from_block\") [] from_block)\n)\n(new $update\n(new $last_blocks\n(seq\n(seq\n(seq\n(null)\n(call %init_peer_id% (listener_id \"poll_deals\") [info.$.net! info.$.address! from_block] result)\n)\n(xor\n(match result.$.success! true\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(new $array-inline\n(seq\n(ap \"found deals\" $array-inline)\n(canon %init_peer_id% $array-inline #array-inline-0)\n)\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"decider <\" spell_id \">\"] title)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [title #array-inline-0])\n)\n(ap from_block $last_blocks)\n)\n(fold result.$.result! deal-0\n(seq\n(xor\n(mismatch from_block deal-0.$.block_number!\n(xor\n(seq\n(ap deal-0.$.block_number! $last_blocks)\n(xor\n(match true true\n(xor\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-1\n(seq\n(seq\n(seq\n(seq\n(ap \"joining the deal\" $array-inline-1)\n(ap deal-0.$.info.deal_id! $array-inline-1)\n)\n(ap \"from_block\" $array-inline-1)\n)\n(ap deal-0.$.block_number! $array-inline-1)\n)\n(canon %init_peer_id% $array-inline-1 #array-inline-1-0)\n)\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"decider <\" spell_id \">\"] title-0)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [title-0 #array-inline-1-0])\n)\n(new $status\n(seq\n(seq\n(new $settings\n(new $result-0\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(new $status-0\n(new $result-1\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (spell_id \"get_string\") [\"worker_script\"] value)\n(xor\n(match value.$.success! false\n(ap false $status-0)\n)\n(xor\n(match value.$.absent! true\n(ap false $status-0)\n)\n(seq\n(ap value.$.str! $result-1)\n(ap true $status-0)\n)\n)\n)\n)\n(canon %init_peer_id% $result-1 #-result-fix-0)\n)\n(ap #-result-fix-0 -result-flat-0)\n)\n(new $status-0_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] status-0_incr)\n(fold $status-0 s\n(seq\n(seq\n(ap s $status-0_test)\n(canon %init_peer_id% $status-0_test #status-0_iter_canon)\n)\n(xor\n(match #status-0_iter_canon.length status-0_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $status-0_test #status-0_result_canon)\n)\n(ap #status-0_result_canon status-0_gate)\n)\n)\n)\n)\n)\n(new $status-1\n(new $result-2\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (spell_id \"get_string\") [\"worker_config\"] value-0)\n(xor\n(match value-0.$.success! false\n(ap false $status-1)\n)\n(xor\n(match value-0.$.absent! true\n(ap false $status-1)\n)\n(seq\n(ap value-0.$.str! $result-2)\n(ap true $status-1)\n)\n)\n)\n)\n(canon %init_peer_id% $result-2 #-result-fix-0-0)\n)\n(ap #-result-fix-0-0 -result-flat-0-0)\n)\n(new $status-1_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] status-1_incr)\n(fold $status-1 s\n(seq\n(seq\n(ap s $status-1_test)\n(canon %init_peer_id% $status-1_test #status-1_iter_canon)\n)\n(xor\n(match #status-1_iter_canon.length status-1_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $status-1_test #status-1_result_canon)\n)\n(ap #status-1_result_canon status-1_gate)\n)\n)\n)\n)\n)\n)\n(new $status-2\n(new $result-3\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (spell_id \"get_string\") [\"worker_ipfs\"] value-1)\n(xor\n(match value-1.$.success! false\n(ap false $status-2)\n)\n(xor\n(match value-1.$.absent! true\n(ap false $status-2)\n)\n(seq\n(ap value-1.$.str! $result-3)\n(ap true $status-2)\n)\n)\n)\n)\n(canon %init_peer_id% $result-3 #-result-fix-0-1)\n)\n(ap #-result-fix-0-1 -result-flat-0-1)\n)\n(new $status-2_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] status-2_incr)\n(fold $status-2 s\n(seq\n(seq\n(ap s $status-2_test)\n(canon %init_peer_id% $status-2_test #status-2_iter_canon)\n)\n(xor\n(match #status-2_iter_canon.length status-2_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $status-2_test #status-2_result_canon)\n)\n(ap #status-2_result_canon status-2_gate)\n)\n)\n)\n)\n)\n)\n(xor\n(match status-0_gate.$.[0]! false\n(xor\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-2\n(seq\n(ap \"worker_script doesn't set\" $array-inline-2)\n(canon %init_peer_id% $array-inline-2 #array-inline-2-0)\n)\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"decider <\" spell_id \">\"] title-1)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [title-1 #array-inline-2-0])\n)\n(call %init_peer_id% (spell_id \"list_push_string\") [\"custom_error\" \"worker_script doesn't set\"])\n)\n(ap false $result-0)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 1])\n)\n)\n(xor\n(match status-1_gate.$.[0]! false\n(xor\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-3\n(seq\n(ap \"worker_config doesn't set\" $array-inline-3)\n(canon %init_peer_id% $array-inline-3 #array-inline-3-0)\n)\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"decider <\" spell_id \">\"] title-2)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [title-2 #array-inline-3-0])\n)\n(call %init_peer_id% (spell_id \"list_push_string\") [\"custom_error\" \"worker_config doesn't set\"])\n)\n(ap false $result-0)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 2])\n)\n)\n(xor\n(match status-2_gate.$.[0]! false\n(xor\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-4\n(seq\n(ap \"worker_ipfs doesn't set\" $array-inline-4)\n(canon %init_peer_id% $array-inline-4 #array-inline-4-0)\n)\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"decider <\" spell_id \">\"] title-3)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [title-3 #array-inline-4-0])\n)\n(call %init_peer_id% (spell_id \"list_push_string\") [\"custom_error\" \"worker_ipfs doesn't set\"])\n)\n(ap false $result-0)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 3])\n)\n)\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"json\" \"parse\") [-result-flat-0.$.[0]!] worker_script)\n(call %init_peer_id% (\"json\" \"parse\") [-result-flat-0-0.$.[0]!] worker_config)\n)\n(call %init_peer_id% (\"json\" \"parse\") [-result-flat-0-1.$.[0]!] worker_ipfs)\n)\n(call %init_peer_id% (\"json\" \"obj\") [\"worker_config\" worker_config \"worker_ipfs\" worker_ipfs \"worker_script\" worker_script] WorkerSettings_obj)\n)\n(ap WorkerSettings_obj $settings)\n)\n(ap true $result-0)\n)\n)\n)\n)\n)\n(canon %init_peer_id% $settings #-settings-fix-0)\n)\n(ap #-settings-fix-0 -settings-flat-0)\n)\n(new $result-0_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] result-0_incr)\n(fold $result-0 s\n(seq\n(seq\n(ap s $result-0_test)\n(canon %init_peer_id% $result-0_test #result-0_iter_canon)\n)\n(xor\n(match #result-0_iter_canon.length result-0_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $result-0_test #result-0_result_canon)\n)\n(ap #result-0_result_canon result-0_gate)\n)\n)\n)\n)\n)\n(xor\n(match result-0_gate.$.[0]! false\n(ap false $status)\n)\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"scope\" \"get_peer_id\") [] worker_peer_id)\n(xor\n(seq\n(seq\n(call worker_peer_id (\"json\" \"obj\") [\"deal_id\" deal-0.$.info.deal_id! \"ipfs\" -settings-flat-0.$.[0].worker_ipfs! \"worker_def_cid\" deal-0.$.info.app_cid!] WorkerArgs_obj)\n(null)\n)\n(call worker_peer_id (\"spell\" \"install\") [-settings-flat-0.$.[0].worker_script! WorkerArgs_obj -settings-flat-0.$.[0].worker_config!] worker_spell_id)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 4])\n)\n)\n(call %init_peer_id% (\"json\" \"obj\") [\"deal_id\" deal-0.$.info.deal_id! \"spell_id\" worker_spell_id] JoinedDeal_obj)\n)\n(call %init_peer_id% (\"json\" \"stringify\") [JoinedDeal_obj] msg-5)\n)\n(call %init_peer_id% (spell_id \"list_push_string\") [\"joined_deals\" msg-5])\n)\n(ap true $status)\n)\n)\n)\n(new $status_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] status_incr)\n(fold $status s\n(seq\n(seq\n(ap s $status_test)\n(canon %init_peer_id% $status_test #status_iter_canon)\n)\n(xor\n(match #status_iter_canon.length status_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $status_test #status_result_canon)\n)\n(ap #status_result_canon status_gate)\n)\n)\n)\n)\n)\n(xor\n(match status_gate.$.[0]! true\n(xor\n(seq\n(seq\n(new $array-inline-5\n(seq\n(seq\n(ap \"joined the deal\" $array-inline-5)\n(ap deal-0.$.info.deal_id! $array-inline-5)\n)\n(canon %init_peer_id% $array-inline-5 #array-inline-5-0)\n)\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"decider <\" spell_id \">\"] title-4)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [title-4 #array-inline-5-0])\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 5])\n)\n)\n(seq\n(seq\n(new $array-inline-6\n(seq\n(seq\n(ap \"couldn't join the deal\" $array-inline-6)\n(ap deal-0.$.info.deal_id! $array-inline-6)\n)\n(canon %init_peer_id% $array-inline-6 #array-inline-6-0)\n)\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"decider <\" spell_id \">\"] title-5)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [title-5 #array-inline-6-0])\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 6])\n)\n)\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-7\n(seq\n(seq\n(seq\n(seq\n(ap \"skipping deal for deal id\" $array-inline-7)\n(ap deal-0.$.info.deal_id! $array-inline-7)\n)\n(ap \"from_block\" $array-inline-7)\n)\n(ap deal-0.$.block_number! $array-inline-7)\n)\n(canon %init_peer_id% $array-inline-7 #array-inline-7-0)\n)\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"decider <\" spell_id \">\"] title-6)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [title-6 #array-inline-7-0])\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"skipping \" deal-0.$.info.deal_id!] msg)\n)\n(call %init_peer_id% (spell_id \"list_push_string\") [\"custom_warning\" msg])\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 7])\n)\n)\n(call %init_peer_id% (\"op\" \"noop\") [])\n)\n(next deal-0)\n)\n)\n)\n(canon %init_peer_id% $last_blocks #last_blocks_canon)\n)\n(call %init_peer_id% (\"op\" \"array_length\") [#last_blocks_canon] len)\n)\n(call %init_peer_id% (\"math\" \"sub\") [len 1] sub)\n)\n(new $last_blocks_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [sub 1] last_blocks_incr)\n(fold $last_blocks s\n(seq\n(seq\n(ap s $last_blocks_test)\n(canon %init_peer_id% $last_blocks_test #last_blocks_iter_canon)\n)\n(xor\n(match #last_blocks_iter_canon.length last_blocks_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $last_blocks_test #last_blocks_result_canon)\n)\n(ap #last_blocks_result_canon last_blocks_gate)\n)\n)\n)\n(call %init_peer_id% (\"math\" \"sub\") [len 1] sub-0)\n)\n(new $array-inline-8\n(seq\n(seq\n(seq\n(seq\n(ap \"old from_block\" $array-inline-8)\n(ap from_block $array-inline-8)\n)\n(ap \"new from_block\" $array-inline-8)\n)\n(ap last_blocks_gate.$.[sub-0]! $array-inline-8)\n)\n(canon %init_peer_id% $array-inline-8 #array-inline-8-0)\n)\n)\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"decider <\" spell_id \">\"] title-7)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [title-7 #array-inline-8-0])\n)\n(call %init_peer_id% (\"json\" \"obj\") [\"from_block\" last_blocks_gate.$.[sub-0]!] Update_obj)\n)\n(ap Update_obj $update)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 8])\n)\n)\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"decider <\" spell_id \">\"] title-8)\n(call %init_peer_id% (\"run-console\" \"print\") [title-8 result.$.error!])\n)\n(call %init_peer_id% (spell_id \"list_push_string\") [\"custom_error\" result.$.error.[0]!])\n)\n(call %init_peer_id% (\"json\" \"obj\") [\"from_block\" from_block] Update_obj-0)\n)\n(ap Update_obj-0 $update)\n)\n)\n)\n(new $update_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] update_incr)\n(fold $update s\n(seq\n(seq\n(ap s $update_test)\n(canon %init_peer_id% $update_test #update_iter_canon)\n)\n(xor\n(match #update_iter_canon.length update_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $update_test #update_result_canon)\n)\n(ap #update_result_canon update_gate)\n)\n)\n)\n)\n)\n)\n(xor\n(call %init_peer_id% (\"callbackSrv\" \"response\") [update_gate.$.[0]!])\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 9])\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 10])\n)",
  "cfg": {
    "clock": {
      "start_sec": 1,
      "end_sec": 0,
      "period_sec": 30
    },
    "connections": {
      "connect": false,
      "disconnect": false
    },
    "blockchain": {
      "start_block": 0,
      "end_block": 0
    }
  },
  "dat": {
    "listener_id": "f759117f-e0c6-4ca2-a6c0-2a297f34355e",
    "info": {
      "net": "testnet",
      "address": "0x432FE883CfF46313aA2C35D2f0b5D9785E9eE711"
    },
    "from_block": "latest",
    "worker_ipfs": "/dns4/ipfs.fluence.dev/tcp/5001",
    "worker_script": "; This file is auto-generated. Do not edit manually: changes may be erased.\n; Generated by Aqua compiler: https://github.com/fluencelabs/aqua/.\n; If you find any bugs, please write an issue on GitHub: https://github.com/fluencelabs/aqua/issues\n; Aqua version: 0.9.5\n\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id)\n(call %init_peer_id% (\"getDataSrv\" \"ipfs\") [] ipfs)\n)\n(call %init_peer_id% (\"getDataSrv\" \"deal_id\") [] deal_id)\n)\n(call %init_peer_id% (\"getDataSrv\" \"worker_def_cid\") [] worker_def_cid)\n)\n(new $array-inline\n(seq\n(seq\n(seq\n(seq\n(seq\n(ap \"worker\" $array-inline)\n(ap spell_id $array-inline)\n)\n(ap deal_id $array-inline)\n)\n(ap worker_def_cid $array-inline)\n)\n(ap ipfs $array-inline)\n)\n(canon %init_peer_id% $array-inline #array-inline-0)\n)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-0])\n)\n(new $worker_spell\n(new $reg_errs\n(new $cre_errs\n(seq\n(seq\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-1)\n(xor\n(call %init_peer_id% (\"srv\" \"resolve_alias\") [\"worker-spell\"] $worker_spell)\n(ap spell_id-1 $worker_spell)\n)\n)\n(xor\n(seq\n(new $worker_spell_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] worker_spell_incr)\n(fold $worker_spell s\n(seq\n(seq\n(ap s $worker_spell_test)\n(canon %init_peer_id% $worker_spell_test #worker_spell_iter_canon)\n)\n(xor\n(match #worker_spell_iter_canon.length worker_spell_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $worker_spell_test #worker_spell_result_canon)\n)\n(ap #worker_spell_result_canon worker_spell_gate)\n)\n)\n(mismatch worker_spell_gate.$.[0]! spell_id-1\n(xor\n(seq\n(seq\n(seq\n(new $array-inline-1\n(seq\n(seq\n(seq\n(seq\n(ap \"Another worker spell is deployed on this worker (existing, current)\" $array-inline-1)\n(new $worker_spell_test-0\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] worker_spell_incr-0)\n(fold $worker_spell s\n(seq\n(seq\n(ap s $worker_spell_test-0)\n(canon %init_peer_id% $worker_spell_test-0 #worker_spell_iter_canon-0)\n)\n(xor\n(match #worker_spell_iter_canon-0.length worker_spell_incr-0\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $worker_spell_test-0 #worker_spell_result_canon-0)\n)\n(ap #worker_spell_result_canon-0 worker_spell_gate-0)\n)\n)\n)\n(ap worker_spell_gate-0.$.[0]! $array-inline-1)\n)\n(ap spell_id-1 $array-inline-1)\n)\n(canon %init_peer_id% $array-inline-1 #array-inline-1-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-2)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-1-0] str)\n)\n(par\n(call %init_peer_id% (spell_id-2 \"list_push_string\") [\"logs\" str])\n(seq\n(new $array-inline-2\n(seq\n(seq\n(ap spell_id-2 $array-inline-2)\n(ap #array-inline-1-0 $array-inline-2)\n)\n(canon %init_peer_id% $array-inline-2 #array-inline-2-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-2-0])\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 1])\n)\n)\n)\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-3\n(seq\n(seq\n(ap \"Installing worker for deal\" $array-inline-3)\n(ap deal_id $array-inline-3)\n)\n(canon %init_peer_id% $array-inline-3 #array-inline-3-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-3)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-3-0] str-0)\n)\n(par\n(call %init_peer_id% (spell_id-3 \"list_push_string\") [\"logs\" str-0])\n(seq\n(new $array-inline-4\n(seq\n(seq\n(ap spell_id-3 $array-inline-4)\n(ap #array-inline-3-0 $array-inline-4)\n)\n(canon %init_peer_id% $array-inline-4 #array-inline-4-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-4-0])\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-4)\n)\n(xor\n(seq\n(call %init_peer_id% (\"aqua-ipfs\" \"cat_from\") [worker_def_cid ipfs] json)\n(xor\n(match json.$.success! true\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"json\" \"parse\") [json.$.contents!] worker_definition)\n(new $array-inline-5\n(seq\n(seq\n(ap \"parsed worker definition\" $array-inline-5)\n(ap worker_definition $array-inline-5)\n)\n(canon %init_peer_id% $array-inline-5 #array-inline-5-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-5)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-5-0] str-1)\n)\n(par\n(call %init_peer_id% (spell_id-5 \"list_push_string\") [\"logs\" str-1])\n(seq\n(new $array-inline-6\n(seq\n(seq\n(ap spell_id-5 $array-inline-6)\n(ap #array-inline-5-0 $array-inline-6)\n)\n(canon %init_peer_id% $array-inline-6 #array-inline-6-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-6-0])\n)\n)\n)\n(fold worker_definition.$.services! s-0\n(seq\n(new $hashes\n(xor\n(seq\n(seq\n(seq\n(seq\n(fold s-0.$.modules! m-0\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"aqua-ipfs\" \"get_from\") [m-0.$.wasm! ipfs] get_wasm)\n(call %init_peer_id% (\"aqua-ipfs\" \"cat_from\") [m-0.$.config! ipfs] json_cfg)\n)\n(call %init_peer_id% (\"json\" \"parse\") [json_cfg.$.contents!] cfg)\n)\n(call %init_peer_id% (\"dist\" \"add_module_from_vault\") [get_wasm.$.path! cfg] hash)\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"hash:\" hash] $hashes)\n)\n(next m-0)\n)\n)\n(par\n(canon %init_peer_id% $hashes #hashes_canon)\n(null)\n)\n)\n(call %init_peer_id% (\"dist\" \"make_blueprint\") [s-0.$.name! #hashes_canon] blueprint)\n)\n(call %init_peer_id% (\"dist\" \"add_blueprint\") [blueprint] blueprint_id)\n)\n(xor\n(seq\n(new $result\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-6)\n(call %init_peer_id% (spell_id-6 \"exists\") [s-0.$.name!] deployed)\n)\n(xor\n(match deployed.$.flag! true\n(xor\n(seq\n(seq\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"blueprint:\" s-0.$.name!] concat_strings)\n(call %init_peer_id% (spell_id-6 \"get_string\") [concat_strings] stored_blueprint)\n)\n(xor\n(match stored_blueprint.$.str! blueprint_id\n(ap true $result)\n)\n(ap false $result)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 2])\n)\n)\n(ap false $result)\n)\n)\n(new $result_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] result_incr)\n(fold $result s\n(seq\n(seq\n(ap s $result_test)\n(canon %init_peer_id% $result_test #result_iter_canon)\n)\n(xor\n(match #result_iter_canon.length result_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $result_test #result_result_canon)\n)\n(ap #result_result_canon result_gate)\n)\n)\n)\n)\n(match result_gate.$.[0]! false\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (spell_id-4 \"set_string\") [\"status\" \"install in progress\"])\n(call %init_peer_id% (\"srv\" \"create\") [blueprint_id] service_id)\n)\n(new $array-inline-7\n(seq\n(seq\n(seq\n(ap \"Created service\" $array-inline-7)\n(ap s-0.$.name! $array-inline-7)\n)\n(ap service_id $array-inline-7)\n)\n(canon %init_peer_id% $array-inline-7 #array-inline-7-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-7)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-7-0] str-2)\n)\n(par\n(call %init_peer_id% (spell_id-7 \"list_push_string\") [\"logs\" str-2])\n(seq\n(new $array-inline-8\n(seq\n(seq\n(ap spell_id-7 $array-inline-8)\n(ap #array-inline-7-0 $array-inline-8)\n)\n(canon %init_peer_id% $array-inline-8 #array-inline-8-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-8-0])\n)\n)\n)\n(xor\n(call %init_peer_id% (\"srv\" \"add_alias\") [s-0.$.name! service_id])\n(seq\n(seq\n(seq\n(new $array-inline-9\n(seq\n(seq\n(seq\n(seq\n(ap \"Error creating alias for deployed service\" $array-inline-9)\n(ap s-0.$.name! $array-inline-9)\n)\n(ap service_id $array-inline-9)\n)\n(ap %last_error% $array-inline-9)\n)\n(canon %init_peer_id% $array-inline-9 #array-inline-9-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-8)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-9-0] str-3)\n)\n(par\n(call %init_peer_id% (spell_id-8 \"list_push_string\") [\"logs\" str-3])\n(seq\n(new $array-inline-10\n(seq\n(seq\n(ap spell_id-8 $array-inline-10)\n(ap #array-inline-9-0 $array-inline-10)\n)\n(canon %init_peer_id% $array-inline-10 #array-inline-10-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-10-0])\n)\n)\n)\n)\n)\n(call %init_peer_id% (spell_id-4 \"set_string\") [s-0.$.name! service_id])\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"blueprint:\" s-0.$.name!] concat_strings-0)\n)\n(call %init_peer_id% (spell_id-4 \"set_string\") [concat_strings-0 blueprint_id])\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 3])\n)\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-11\n(seq\n(seq\n(ap s-0.$.name! $array-inline-11)\n(ap \"is already deployed, doing nothing\" $array-inline-11)\n)\n(canon %init_peer_id% $array-inline-11 #array-inline-11-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-9)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-11-0] str-4)\n)\n(par\n(call %init_peer_id% (spell_id-9 \"list_push_string\") [\"logs\" str-4])\n(seq\n(new $array-inline-12\n(seq\n(seq\n(ap spell_id-9 $array-inline-12)\n(ap #array-inline-11-0 $array-inline-12)\n)\n(canon %init_peer_id% $array-inline-12 #array-inline-12-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-12-0])\n)\n)\n)\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-13\n(seq\n(seq\n(seq\n(ap \"Error deploying service\" $array-inline-13)\n(ap s-0.$.name! $array-inline-13)\n)\n(ap %last_error% $array-inline-13)\n)\n(canon %init_peer_id% $array-inline-13 #array-inline-13-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-10)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-13-0] str-5)\n)\n(par\n(call %init_peer_id% (spell_id-10 \"list_push_string\") [\"logs\" str-5])\n(seq\n(new $array-inline-14\n(seq\n(seq\n(ap spell_id-10 $array-inline-14)\n(ap #array-inline-13-0 $array-inline-14)\n)\n(canon %init_peer_id% $array-inline-14 #array-inline-14-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-14-0])\n)\n)\n)\n)\n)\n(next s-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-11)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [\"Installation finished\"] str-6)\n)\n(par\n(call %init_peer_id% (spell_id-11 \"list_push_string\") [\"logs\" str-6])\n(seq\n(new $array-inline-15\n(seq\n(seq\n(ap spell_id-11 $array-inline-15)\n(ap \"Installation finished\" $array-inline-15)\n)\n(canon %init_peer_id% $array-inline-15 #array-inline-15-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-15-0])\n)\n)\n)\n(call %init_peer_id% (spell_id-4 \"set_string\") [\"status\" \"install finished\"])\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 4])\n)\n)\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-16\n(seq\n(seq\n(seq\n(seq\n(ap \"Error downloading worker definition from IPFS\" $array-inline-16)\n(ap ipfs $array-inline-16)\n)\n(ap worker_def_cid $array-inline-16)\n)\n(ap json $array-inline-16)\n)\n(canon %init_peer_id% $array-inline-16 #array-inline-16-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-12)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-16-0] str-7)\n)\n(par\n(call %init_peer_id% (spell_id-12 \"list_push_string\") [\"logs\" str-7])\n(seq\n(new $array-inline-17\n(seq\n(seq\n(ap spell_id-12 $array-inline-17)\n(ap #array-inline-16-0 $array-inline-17)\n)\n(canon %init_peer_id% $array-inline-17 #array-inline-17-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-17-0])\n)\n)\n)\n(call %init_peer_id% (spell_id-4 \"set_string\") [\"status\" \"install error\"])\n)\n)\n)\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-18\n(seq\n(seq\n(ap \"Error installing worker\" $array-inline-18)\n(ap %last_error% $array-inline-18)\n)\n(canon %init_peer_id% $array-inline-18 #array-inline-18-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-13)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-18-0] str-8)\n)\n(par\n(call %init_peer_id% (spell_id-13 \"list_push_string\") [\"logs\" str-8])\n(seq\n(new $array-inline-19\n(seq\n(seq\n(ap spell_id-13 $array-inline-19)\n(ap #array-inline-18-0 $array-inline-19)\n)\n(canon %init_peer_id% $array-inline-19 #array-inline-19-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-19-0])\n)\n)\n)\n(call %init_peer_id% (spell_id-4 \"set_string\") [\"status\" \"install error\"])\n)\n)\n)\n(call %init_peer_id% (spell_id-1 \"get_string\") [\"status\"] status)\n)\n(new $array-inline-20\n(seq\n(seq\n(ap \"Worker installation finished with status\" $array-inline-20)\n(ap status.$.str! $array-inline-20)\n)\n(canon %init_peer_id% $array-inline-20 #array-inline-20-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-14)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-20-0] str-9)\n)\n(par\n(call %init_peer_id% (spell_id-14 \"list_push_string\") [\"logs\" str-9])\n(seq\n(new $array-inline-21\n(seq\n(seq\n(ap spell_id-14 $array-inline-21)\n(ap #array-inline-20-0 $array-inline-21)\n)\n(canon %init_peer_id% $array-inline-21 #array-inline-21-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-21-0])\n)\n)\n)\n(xor\n(match status.$.str! \"install finished\"\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(new $successful\n(new $subnetwork_id\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"peer\" \"timestamp_sec\") [] t)\n(xor\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"insecure_sig\" \"get_peer_id\") [] peer_id)\n(new $option-inline\n(seq\n(xor\n(ap peer_id $option-inline)\n(null)\n)\n(canon %init_peer_id% $option-inline #option-inline-0)\n)\n)\n)\n(call %init_peer_id% (\"registry\" \"get_key_bytes\") [deal_id #option-inline-0 t [] \"\"] bytes)\n)\n(call %init_peer_id% (\"insecure_sig\" \"sign\") [bytes] result-0)\n)\n(xor\n(match result-0.$.success! false\n(ap result-0.$.error.[0]! $error)\n)\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(ap result-0.$.signature! result-0_flat)\n(call %init_peer_id% (\"registry\" \"get_key_id\") [deal_id peer_id] id)\n)\n(call %init_peer_id% (\"op\" \"string_to_b58\") [id] k)\n)\n(call %init_peer_id% (\"kad\" \"neighborhood\") [k [] []] nodes)\n)\n(xor\n(par\n(fold nodes n-0\n(par\n(seq\n(xor\n(xor\n(seq\n(seq\n(seq\n(seq\n(call n-0 (\"peer\" \"timestamp_sec\") [] t-0)\n(call n-0 (\"trust-graph\" \"get_weight\") [peer_id t-0] weight)\n)\n(new $option-inline-1\n(seq\n(xor\n(ap peer_id $option-inline-1)\n(null)\n)\n(canon n-0 $option-inline-1 #option-inline-1-0)\n)\n)\n)\n(call n-0 (\"registry\" \"register_key\") [deal_id #option-inline-1-0 t [] \"\" result-0_flat.$.[0]! weight t-0] result-1)\n)\n(xor\n(match result-1.$.success! true\n(ap true $successful)\n)\n(ap result-1.$.error! $error)\n)\n)\n(call n-0 (\"op\" \"noop\") [])\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 5])\n)\n(call %init_peer_id% (\"op\" \"noop\") [])\n)\n(next n-0)\n)\n(never)\n)\n(null)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 6])\n)\n)\n(new $status-0\n(new $result-2\n(seq\n(seq\n(seq\n(par\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"sub\") [1 1] sub)\n(new $successful_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [sub 1] successful_incr)\n(fold $successful s\n(seq\n(seq\n(ap s $successful_test)\n(canon %init_peer_id% $successful_test #successful_iter_canon)\n)\n(xor\n(match #successful_iter_canon.length successful_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $successful_test #successful_result_canon)\n)\n(ap #successful_result_canon successful_gate)\n)\n)\n)\n(call %init_peer_id% (\"math\" \"sub\") [1 1] sub-0)\n)\n(ap \"ok\" $status-0)\n)\n(call %init_peer_id% (\"peer\" \"timeout\") [6000 \"timeout\"] $status-0)\n)\n(new $status-0_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] status-0_incr)\n(fold $status-0 s\n(seq\n(seq\n(ap s $status-0_test)\n(canon %init_peer_id% $status-0_test #status-0_iter_canon)\n)\n(xor\n(match #status-0_iter_canon.length status-0_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $status-0_test #status-0_result_canon)\n)\n(ap #status-0_result_canon status-0_gate)\n)\n)\n)\n(xor\n(match status-0_gate.$.[0]! \"ok\"\n(ap true $result-2)\n)\n(ap false $result-2)\n)\n)\n(new $result-2_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] result-2_incr)\n(fold $result-2 s\n(seq\n(seq\n(ap s $result-2_test)\n(canon %init_peer_id% $result-2_test #result-2_iter_canon)\n)\n(xor\n(match #result-2_iter_canon.length result-2_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $result-2_test #result-2_result_canon)\n)\n(ap #result-2_result_canon result-2_gate)\n)\n)\n)\n)\n)\n)\n(xor\n(match result-2_gate.$.[0]! false\n(ap \"key wasn't created: timeout exceeded\" $error)\n)\n(ap id $subnetwork_id)\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 7])\n)\n)\n(canon %init_peer_id% $subnetwork_id #-subnetwork_id-fix-0)\n)\n(ap #-subnetwork_id-fix-0 -subnetwork_id-flat-0)\n)\n)\n)\n(new $array-inline-22\n(seq\n(seq\n(ap \"Subnet created\" $array-inline-22)\n(ap -subnetwork_id-flat-0 $array-inline-22)\n)\n(canon %init_peer_id% $array-inline-22 #array-inline-22-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-15)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-22-0] str-10)\n)\n(par\n(call %init_peer_id% (spell_id-15 \"list_push_string\") [\"logs\" str-10])\n(seq\n(new $array-inline-23\n(seq\n(seq\n(ap spell_id-15 $array-inline-23)\n(ap #array-inline-22-0 $array-inline-23)\n)\n(canon %init_peer_id% $array-inline-23 #array-inline-23-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-23-0])\n)\n)\n)\n(xor\n(mismatch -subnetwork_id-flat-0 []\n(xor\n(seq\n(new $successful-0\n(new $error_get\n(new $success\n(seq\n(seq\n(seq\n(new $error-1\n(new $result-3\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"peer\" \"timestamp_sec\") [] t-2)\n(new $option-inline-2\n(seq\n(xor\n(ap %init_peer_id% $option-inline-2)\n(null)\n)\n(canon %init_peer_id% $option-inline-2 #option-inline-2-0)\n)\n)\n)\n(call %init_peer_id% (\"registry\" \"get_record_metadata_bytes\") [-subnetwork_id-flat-0.$.[0]! %init_peer_id% t-2 \"\" %init_peer_id% #option-inline-2-0 [] []] bytes-0)\n)\n(xor\n(call %init_peer_id% (\"sig\" \"sign\") [bytes-0] sig_result-0)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 8])\n)\n)\n(xor\n(match sig_result-0.$.success! true\n(xor\n(call %init_peer_id% (\"registry\" \"create_record_metadata\") [-subnetwork_id-flat-0.$.[0]! %init_peer_id% t-2 \"\" %init_peer_id% #option-inline-2-0 [] [] sig_result-0.$.signature.[0]!] $result-3)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 9])\n)\n)\n(ap sig_result-0.$.error.[0]! $error-1)\n)\n)\n(canon %init_peer_id% $result-3 #-result-fix-0)\n)\n(ap #-result-fix-0 -result-flat-0)\n)\n(canon %init_peer_id% $error-1 #-error-fix-1)\n)\n(ap #-error-fix-1 -error-flat-1)\n)\n)\n)\n(xor\n(match -result-flat-0 []\n(seq\n(ap false $success)\n(ap -error-flat-1.$.[0]! $error-0)\n)\n)\n(seq\n(seq\n(call %init_peer_id% (\"peer\" \"timestamp_sec\") [] t-1)\n(new $signature\n(seq\n(seq\n(call %init_peer_id% (\"registry\" \"get_record_bytes\") [-result-flat-0.$.[0]! t-1] bytes-1)\n(xor\n(call %init_peer_id% (\"sig\" \"sign\") [bytes-1] $signature)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 10])\n)\n)\n(new $signature_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] signature_incr)\n(fold $signature s\n(seq\n(seq\n(ap s $signature_test)\n(canon %init_peer_id% $signature_test #signature_iter_canon)\n)\n(xor\n(match #signature_iter_canon.length signature_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $signature_test #signature_result_canon)\n)\n(ap #signature_result_canon signature_gate)\n)\n)\n)\n)\n)\n(xor\n(match signature_gate.$.[0].success! false\n(seq\n(ap signature_gate.$.[0].error.[0]! $error-0)\n(ap false $success)\n)\n)\n(seq\n(new $resources\n(new $successful-1\n(new $result-4\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"op\" \"string_to_b58\") [-subnetwork_id-flat-0.$.[0]!] k-0)\n(call %init_peer_id% (\"kad\" \"neighborhood\") [k-0 [] []] nodes-2)\n)\n(par\n(fold nodes-2 n-2-0\n(par\n(seq\n(xor\n(xor\n(seq\n(call n-2-0 (\"registry\" \"get_key_metadata\") [-subnetwork_id-flat-0.$.[0]!] get_result)\n(xor\n(match get_result.$.success! true\n(seq\n(ap get_result.$.key! $resources)\n(ap true $successful-1)\n)\n)\n(seq\n(call n-2-0 (\"op\" \"concat_strings\") [get_result.$.error! \" on \"] e)\n(call n-2-0 (\"op\" \"concat_strings\") [e n-2-0] $error-2)\n)\n)\n)\n(call n-2-0 (\"op\" \"noop\") [])\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 11])\n)\n(call %init_peer_id% (\"op\" \"noop\") [])\n)\n(next n-2-0)\n)\n(never)\n)\n(null)\n)\n)\n(new $status-1\n(new $result-5\n(seq\n(seq\n(seq\n(par\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"sub\") [1 1] sub-1)\n(new $successful-1_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [sub-1 1] successful-1_incr)\n(fold $successful-1 s\n(seq\n(seq\n(ap s $successful-1_test)\n(canon %init_peer_id% $successful-1_test #successful-1_iter_canon)\n)\n(xor\n(match #successful-1_iter_canon.length successful-1_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $successful-1_test #successful-1_result_canon)\n)\n(ap #successful-1_result_canon successful-1_gate)\n)\n)\n)\n(call %init_peer_id% (\"math\" \"sub\") [1 1] sub-2)\n)\n(ap \"ok\" $status-1)\n)\n(call %init_peer_id% (\"peer\" \"timeout\") [6000 \"timeout\"] $status-1)\n)\n(new $status-1_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] status-1_incr)\n(fold $status-1 s\n(seq\n(seq\n(ap s $status-1_test)\n(canon %init_peer_id% $status-1_test #status-1_iter_canon)\n)\n(xor\n(match #status-1_iter_canon.length status-1_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $status-1_test #status-1_result_canon)\n)\n(ap #status-1_result_canon status-1_gate)\n)\n)\n)\n(xor\n(match status-1_gate.$.[0]! \"ok\"\n(ap true $result-5)\n)\n(ap false $result-5)\n)\n)\n(new $result-5_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] result-5_incr)\n(fold $result-5 s\n(seq\n(seq\n(ap s $result-5_test)\n(canon %init_peer_id% $result-5_test #result-5_iter_canon)\n)\n(xor\n(match #result-5_iter_canon.length result-5_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $result-5_test #result-5_result_canon)\n)\n(ap #result-5_result_canon result-5_gate)\n)\n)\n)\n)\n)\n)\n(xor\n(match result-5_gate.$.[0]! false\n(ap \"resource not found: timeout exceeded\" $error-2)\n)\n(seq\n(seq\n(canon %init_peer_id% $resources #resources_canon)\n(call %init_peer_id% (\"registry\" \"merge_keys\") [#resources_canon] merge_result)\n)\n(xor\n(match merge_result.$.success! true\n(ap merge_result.$.key! $result-4)\n)\n(ap merge_result.$.error! $error-2)\n)\n)\n)\n)\n(canon %init_peer_id% $result-4 #-result-fix-0-0)\n)\n(ap #-result-fix-0-0 -result-flat-0-0)\n)\n)\n)\n)\n(xor\n(match -result-flat-0-0 []\n(xor\n(seq\n(seq\n(canon %init_peer_id% $error-2 #error-2_canon)\n(fold #error-2_canon e-0-0\n(seq\n(ap e-0-0 $error-0)\n(next e-0-0)\n)\n)\n)\n(ap false $success)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 12])\n)\n)\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"peer\" \"timestamp_sec\") [] t-3)\n(call %init_peer_id% (\"trust-graph\" \"get_weight\") [-result-flat-0-0.$.[0].owner_peer_id! t-3] weight-0)\n)\n(call %init_peer_id% (\"registry\" \"republish_key\") [-result-flat-0-0.$.[0]! weight-0 t-3] result-6)\n)\n(xor\n(match result-6.$.success! false\n(seq\n(ap result-6.$.error! $error-0)\n(ap false $success)\n)\n)\n(seq\n(seq\n(seq\n(seq\n(null)\n(call %init_peer_id% (\"peer\" \"timestamp_sec\") [] t-4)\n)\n(call %init_peer_id% (\"trust-graph\" \"get_weight\") [-result-flat-0.$.[0].issued_by! t-4] weight-1)\n)\n(call %init_peer_id% (\"registry\" \"put_record\") [-result-flat-0.$.[0]! t-1 signature_gate.$.[0].signature.[0]! weight-1 t-4] result-7)\n)\n(xor\n(match result-7.$.success! false\n(seq\n(ap result-7.$.error! $error-0)\n(ap false $success)\n)\n)\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"op\" \"string_to_b58\") [-subnetwork_id-flat-0.$.[0]!] k-1)\n(call %init_peer_id% (\"kad\" \"neighborhood\") [k-1 [] []] nodes-3)\n)\n(par\n(fold nodes-3 n-1-0\n(par\n(seq\n(xor\n(xor\n(seq\n(seq\n(seq\n(call n-1-0 (\"peer\" \"timestamp_sec\") [] t-5)\n(call n-1-0 (\"trust-graph\" \"get_weight\") [-result-flat-0-0.$.[0].owner_peer_id! t-5] weight-2)\n)\n(call n-1-0 (\"registry\" \"republish_key\") [-result-flat-0-0.$.[0]! weight-2 t-5] result-8)\n)\n(xor\n(match result-8.$.success! false\n(ap result-8.$.error! $error-0)\n)\n(seq\n(seq\n(seq\n(seq\n(null)\n(call n-1-0 (\"peer\" \"timestamp_sec\") [] t-6)\n)\n(call n-1-0 (\"trust-graph\" \"get_weight\") [-result-flat-0.$.[0].issued_by! t-6] weight-3)\n)\n(call n-1-0 (\"registry\" \"put_record\") [-result-flat-0.$.[0]! t-1 signature_gate.$.[0].signature.[0]! weight-3 t-6] result-9)\n)\n(xor\n(match result-9.$.success! true\n(ap true $successful-0)\n)\n(ap result-9.$.error! $error-0)\n)\n)\n)\n)\n(call n-1-0 (\"op\" \"noop\") [])\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 13])\n)\n(call %init_peer_id% (\"op\" \"noop\") [])\n)\n(next n-1-0)\n)\n(never)\n)\n(null)\n)\n)\n(new $status-2\n(new $result-10\n(seq\n(seq\n(seq\n(par\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"sub\") [1 1] sub-3)\n(new $successful-0_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [sub-3 1] successful-0_incr)\n(fold $successful-0 s\n(seq\n(seq\n(ap s $successful-0_test)\n(canon %init_peer_id% $successful-0_test #successful-0_iter_canon)\n)\n(xor\n(match #successful-0_iter_canon.length successful-0_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $successful-0_test #successful-0_result_canon)\n)\n(ap #successful-0_result_canon successful-0_gate)\n)\n)\n)\n(call %init_peer_id% (\"math\" \"sub\") [1 1] sub-4)\n)\n(ap \"ok\" $status-2)\n)\n(call %init_peer_id% (\"peer\" \"timeout\") [6000 \"timeout\"] $status-2)\n)\n(new $status-2_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] status-2_incr)\n(fold $status-2 s\n(seq\n(seq\n(ap s $status-2_test)\n(canon %init_peer_id% $status-2_test #status-2_iter_canon)\n)\n(xor\n(match #status-2_iter_canon.length status-2_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $status-2_test #status-2_result_canon)\n)\n(ap #status-2_result_canon status-2_gate)\n)\n)\n)\n(xor\n(match status-2_gate.$.[0]! \"ok\"\n(ap true $result-10)\n)\n(ap false $result-10)\n)\n)\n(new $result-10_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] result-10_incr)\n(fold $result-10 s\n(seq\n(seq\n(ap s $result-10_test)\n(canon %init_peer_id% $result-10_test #result-10_iter_canon)\n)\n(xor\n(match #result-10_iter_canon.length result-10_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $result-10_test #result-10_result_canon)\n)\n(ap #result-10_result_canon result-10_gate)\n)\n)\n)\n)\n)\n)\n(ap result-10_gate.$.[0]! $success)\n)\n)\n)\n)\n)\n)\n)\n)\n)\n)\n)\n(new $success_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] success_incr)\n(fold $success s\n(seq\n(seq\n(ap s $success_test)\n(canon %init_peer_id% $success_test #success_iter_canon)\n)\n(xor\n(match #success_iter_canon.length success_incr\n(null)\n)\n(next s)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $success_test #success_result_canon)\n)\n(ap #success_result_canon success_gate)\n)\n)\n)\n(xor\n(match success_gate.$.[0]! false\n(ap \"worker hasn't registered: timeout exceeded\" $error-0)\n)\n(call %init_peer_id% (\"op\" \"noop\") [])\n)\n)\n)\n)\n)\n(xor\n(match success_gate.$.[0]! true\n(xor\n(xor\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"srv\" \"add_alias\") [\"worker-spell\" spell_id-1])\n(new $array-inline-24\n(seq\n(seq\n(ap \"alias created 'worker-spell'\" $array-inline-24)\n(ap spell_id-1 $array-inline-24)\n)\n(canon %init_peer_id% $array-inline-24 #array-inline-24-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-16)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-24-0] str-11)\n)\n(par\n(call %init_peer_id% (spell_id-16 \"list_push_string\") [\"logs\" str-11])\n(seq\n(new $array-inline-25\n(seq\n(seq\n(ap spell_id-16 $array-inline-25)\n(ap #array-inline-24-0 $array-inline-25)\n)\n(canon %init_peer_id% $array-inline-25 #array-inline-25-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-25-0])\n)\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-26\n(seq\n(seq\n(ap \"error creating alias\" $array-inline-26)\n(ap %last_error% $array-inline-26)\n)\n(canon %init_peer_id% $array-inline-26 #array-inline-26-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-17)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-26-0] str-12)\n)\n(par\n(call %init_peer_id% (spell_id-17 \"list_push_string\") [\"logs\" str-12])\n(seq\n(new $array-inline-27\n(seq\n(seq\n(ap spell_id-17 $array-inline-27)\n(ap #array-inline-26-0 $array-inline-27)\n)\n(canon %init_peer_id% $array-inline-27 #array-inline-27-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-27-0])\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 14])\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-28\n(seq\n(seq\n(seq\n(ap \"error registering worker\" $array-inline-28)\n(canon %init_peer_id% $error-0 #push-to-stream-820)\n)\n(ap #push-to-stream-820 $array-inline-28)\n)\n(canon %init_peer_id% $array-inline-28 #array-inline-28-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-18)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-28-0] str-13)\n)\n(par\n(call %init_peer_id% (spell_id-18 \"list_push_string\") [\"logs\" str-13])\n(seq\n(new $array-inline-29\n(seq\n(seq\n(ap spell_id-18 $array-inline-29)\n(ap #array-inline-28-0 $array-inline-29)\n)\n(canon %init_peer_id% $array-inline-29 #array-inline-29-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-29-0])\n)\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 15])\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-30\n(seq\n(seq\n(seq\n(ap \"error creating subnetwork\" $array-inline-30)\n(canon %init_peer_id% $error #push-to-stream-838)\n)\n(ap #push-to-stream-838 $array-inline-30)\n)\n(canon %init_peer_id% $array-inline-30 #array-inline-30-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-19)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-30-0] str-14)\n)\n(par\n(call %init_peer_id% (spell_id-19 \"list_push_string\") [\"logs\" str-14])\n(seq\n(new $array-inline-31\n(seq\n(seq\n(ap spell_id-19 $array-inline-31)\n(ap #array-inline-30-0 $array-inline-31)\n)\n(canon %init_peer_id% $array-inline-31 #array-inline-31-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-31-0])\n)\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 16])\n)\n)\n(call %init_peer_id% (\"op\" \"noop\") [])\n)\n)\n)\n)\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 17])\n)",
    "worker_config": {
      "clock": {
        "start_sec": 1,
        "end_sec": 0,
        "period_sec": 60
      },
      "connections": {
        "connect": false,
        "disconnect": false
      },
      "blockchain": {
        "start_block": 0,
        "end_block": 0
      }
    }
  }
}
